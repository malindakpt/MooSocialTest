(function(a,c){"function"===typeof define&&define.amd?define("jquery mooAjax mooAlert mooButton mooPhrase tinycon slimScroll spinner".split(" "),c):"object"===typeof exports?module.exports=c(require("jquery")):a.mooNotification=c()})(this,function(a,c,n,h,k){var e={},l=!0,m=1E4,p=function(){a("#notificationDropdown")&&(a("#notificationDropdown").unbind("click"),a("#notificationDropdown").click(function(){var b=e.show_notification;"undefined"!=typeof b&&(a(this).next("ul:first").spin("tiny"),c.get({url:b},
function(b){a("#notifications_list").html(b);a("#notificationDropdown").next("ul:first").spin(!1);a(".initSlimScroll").slimScroll({height:"500px"});a("#notifications_list li").hover(function(){a(this).contents().find(".delete-icon").show()},function(){a(this).contents().find(".delete-icon").hide()})}))}));a("#conversationDropdown")&&(a("#conversationDropdown").unbind("click"),a("#conversationDropdown").click(function(){var b=e.show_conversation;a(this).next("ul:first").spin("tiny");c.get({url:b},
function(b){a("#conversation_list").html(b);a("#conversationDropdown").next("ul:first").spin(!1);a(".initSlimScroll").slimScroll({height:"500px"})})}))},q=function(){var b=e.refresh_notification_url;"undefined"!=typeof b&&window.setInterval(function(){a.getJSON(b,function(b){a("#notification_count")&&a("#notification_count").html(b.notification_count);0<parseInt(b.notification_count)?0<a(".notification_count").length?a(".notification_count").html(b.notification_count):a("#notificationDropdown").append('<span class="notification_count">1</span>'):
a(".notification_count")&&a(".notification_count").remove();0<parseInt(b.conversation_count)?0<a(".conversation_count").length?a(".conversation_count").html(b.conversation_count):a("#conversationDropdown").append('<span class="conversation_count">1</span>'):a(".conversation_count")&&a(".conversation_count").remove()}).fail(function(){console.log("Error when calling "+b)})},m)},g=function(b){c.get({url:mooConfig.url.base+"/notifications/ajax_remove/"+b},function(d){a("#noti_"+b).slideUp();a("#noti_"+
b).hasClass("unread")&&"0"!=a("#notification_count").html()&&(d=parseInt(a(".notification_count").html())-1,0==d?a(".notification_count").remove():a(".notification_count").html(d),a("#notification_count").html(d),Tinycon.setBubble(d))})};return{init:function(){l&&(p(),q())},setUrl:function(a){e=a},setActive:function(a){l=a},setInterval:function(a){0<a&&(m=1E3*a)},removeNotification:g,initAjaxShow:function(){a("#notifications_list li").hover(function(){a(this).contents().find(".delete-icon").show()},
function(){a(this).contents().find(".delete-icon").hide()});a(".removeNotification").unbind("click");a(".removeNotification").click(function(){var b=a(this).data();g(b.id)});a(".clearAllNotification").unbind("click");a(".clearAllNotification").click(function(){a.get(mooConfig.url.base+"/notifications/ajax_clear");a(".notification_list").slideUp();a("#new_notifications").fadeOut();a("#notification_count").html("0");a(".notification_count").html("0");Tinycon.setBubble(0)})},initNotification:function(){a("#notificationButton").unbind("click");
a("#notificationButton").click(function(){var b=a("#item_type").val(),d=a("#item_id").val();h.disableButton("notificationButton");a("#notificationButton").spin("small");a.post(mooConfig.url.base+"/notifications/ajax_save",a("#notificationForm").serialize(),function(f){h.enableButton("notificationButton");a("#notificationButton").spin(!1);f=a.parseJSON(f);1==f.result?(a(".error-message").hide(),1==f.is_stop?a("#stop_notification_"+b+d).html(k.__("turn_on_notifications")):a("#stop_notification_"+b+
d).html(k.__("stop_notifications")),n.alert(f.message),a("#portlet-config").modal("hide"),a("#themeModal").modal("hide")):(a(".error-message").show(),a(".error-message").html(f.message))})});return!1},initRemoveNotification:function(){a(".removeNotification").unbind("click");a(".removeNotification").on("click",function(){var b=a(this).data();g(b.id)})},initMarkRead:function(){a(".markMsgStatus").unbind("click");a(".markMsgStatus").click(function(){var b=a(this).data(),d=a(this);c.post({url:mooConfig.url.base+
"/notifications/mark_read",data:{id:b.id,status:b.status}},function(b){b=a.parseJSON(b);var c=a("#notification_count").html();"1"===b.status?(d.parents("li:first").find("a:first").removeClass("unread"),d.hide(),d.next().show(),a("#notification_count").html(parseInt(c)-1),0<parseInt(c)-1?0<a(".notification_count").length?a(".notification_count").html(parseInt(c)-1):a("#notificationDropdown").append('<span class="notification_count">1</span>'):a(".notification_count")&&a(".notification_count").remove()):
(d.parents("li:first").find("a:first").addClass("unread"),d.hide(),d.prev().show(),a("#notification_count").html(parseInt(c)+1),0<a(".notification_count").length?a(".notification_count").html(parseInt(c)+1):a("#notificationDropdown").append('<span class="notification_count">1</span>'))})});a(".markAllNotificationAsRead").unbind("click");a(".markAllNotificationAsRead").click(function(){c.post({url:mooConfig.url.base+"/notifications/mark_all_read",data:{}},function(b){1==a.parseJSON(b).success&&(a(".mark_read").hide(),
a(".mark_unread").show(),a(".notification_count").remove(),a("#notification_count").html("0"),a("#notifications_list li").each(function(b,c){var e=a(c).find("a:first");e.hasClass("unread")&&e.removeClass("unread")}))})});a(".clearAllNotifications").unbind("click");a(".clearAllNotifications").click(function(){c.post({url:mooConfig.url.base+"/notifications/clear_all_notifications",data:{}},function(b){a(".notification_count").remove();a("#notification_count").html("0");a("#notifications_list").html(b);
a("#notificationDropdown").next("ul:first").spin(!1);a(".initSlimScroll").slimScroll({height:"500px"})})})}}});