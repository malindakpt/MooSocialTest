(function(a,g){"function"===typeof define&&define.amd?define("jquery mooPhrase mooMention mooEmoji mooBehavior mooAlert mooTooltip elastislide".split(" "),g):"object"===typeof exports?module.exports=g(require("jquery")):a.mooPhotoTheater=g()})(this,function(a,g,W,X,Y,F,G){function t(){var b=a("#photo_src");a(window).height();var d,c;a("<img/>").attr("src",a(b).attr("src")).load(function(){d=this.width;c=this.height;c>=d?a(b).addClass("verticalImagePopup"):c<f-72?a(b).addClass("horizionImagePopup"):
a(b).addClass("verticalImagePopup");0<a("#theaterPhotoComment").length&&(W.init("theaterPhotoComment"),X.init("theaterPhotoComment"));a("#photo_wrapper").spin(!1);a("#tag-wrapper").show();a("#photo_src").css("visibility","visible");var f,e;992<a(window).width()?(f=a(window).height(),e=a("#photo_wrapper").width(),a("#photoModal #tag-wrapper").height(f-72),a("#photoModal #tag-wrapper .photo_img").height(f-72),a("#photoModal #tag-wrapper").width(e),a("#photoModal .photo_comments").height(f)):(f=a(window).height(),
e=a(window).width(),a("#photoModal #tag-wrapper").height(f-36),a("#photoModal #tag-wrapper .photo_img").height(f-36),a("#photoModal #tag-wrapper").width(e))})}function H(){var b=a("#preload").html();""!=b&&(a("#preload").html(""),element=a("<div>"+b+"</div>"),data=element.find("#photo_wrapper").data(),c=data.photoid,k=data.taguid,e=data.taguserid,l=data.nextphoto,u=data.thumbfull,a("#photo-content #tag-wrapper").hide(),a("#photo-content .photo_comments").hide(),element.find(".photo_comments").html()&&
(a("#photo-content .photo_comments").html(element.find(".photo_comments").html()),a("#photo-content .photo_comments").show()),a("#photo_wrapper .info").html(element.find(".info").html()),a("#photo-content #tag-wrapper").html(element.find("#tag-wrapper").html()),a("#photo-content #lb_description").html(""),a("#photo-content #lb_description").html(element.find("#lb_description").html()),a("#photo_wrapper").spin("large"),I(),t())}function J(b,d){"1"==d&&a("#thumb_list_popup").is(":visible")&&n.setCurrent(a("#photo_thumb_"+
b).index());a("#theaterPhotoComment").destroyOverlayInstance(a("#theaterPhotoComment"));c=b;a("#thumb_list_popup .active").removeClass("active");a("#photo_thumb_"+c).addClass("active");a("#photo_wrapper").spin("large");var h="",h=k?b+"/uid:"+k:b,f=h+"/time/"+(new Date).getTime();e&&(f+="?uid="+e,h+="?uid="+e);a("#preload").load(mooConfig.url.base+"/photos/ajax_view_theater/"+f,{noCache:0},function(){m=!1;a("#photoModal .slimScrollDiv").attr("style","");a("#theaterComments").attr("style","");H();G.init()});
window.history.pushState({photo_id:c},"",mooConfig.url.base+"/photos/view/"+h)}var c,K=!1,n,L=!1,M,v=!0,u,w,N=!1,m=!1,Z=0,l="",O,x=!1,p,q,y,z,A,B,C,D,k=0,e=0,aa=function(){a(".photoDetailTags").on("mouseout",function(){var b=a(this).data();P("0-"+b.tagId)}).on("mouseover",function(){var b=a(this).data();Q("0-"+b.tagId)})},ba=function(){a(".photoDetailRemoveTags").unbind("click");a(".photoDetailRemoveTags").on("click",function(){var b=a(this).data();R("0-"+b.id,b.id)})},S=function(){a(".showPhotoTheater").unbind("click");
a(".showPhotoTheater").on("click",function(){var b=a(this).data();J(b.id,b.thumb)});aa();ba()},U=function(b){a.post(mooConfig.url.base+"/photos/ajax_thumb_theater/"+c+"/"+b+(e?"?uid="+e:""),function(d){a("#photo_thumbs ul").append(d);b==M?T():U(b+1)})},ca=function(){a(document).on("click","a.photoModal",function(b){K&&(b.preventDefault(),a("body").append('<div class="photo_modal_loading"></div>'),a(".photo_modal_loading").spin("large"),a.ajax({url:a(this).attr("href"),success:function(b){a("#photoModal .modal-content").html(b);
a("#photoModal").modal("show");G.init()}}))})},da=function(){a("#photoModal").on("shown.bs.modal",function(b){a(".photo_modal_loading").remove();t();V();v&&T()});a("#photoModal").on("hidden.bs.modal",function(b){history.pushState({},"",w);a("#photoModal .modal-content").html("");a("#photoModal").removeData("bs.modal")})},V=function(){c=a("#photo_wrapper").data("photoid");k=a("#photo_wrapper").data("taguid");e=a("#photo_wrapper").data("taguserid");l=a("#photo_wrapper").data("nextphoto");u=a("#photo_wrapper").data("thumbfull");
var b,d,h=a("#photo_wrapper").data("photocount"),f=a("#photo_wrapper").data("page");h>20*f?(M=Math.ceil(h/20),a("#photo_thumbs").spin(),a("#thumb_list_popup").hide(),v=!1,U(2)):v=!0;L||(a(window).resize(function(){0!=a("#photo-content").length&&(992<a(window).width()?(b=a(window).height(),d=a("#photo_wrapper").width(),a("#photoModal #tag-wrapper").height(b-72),a("#photoModal #tag-wrapper .photo_img").height(b-72),a("#photoModal #tag-wrapper").width(d),a("#photoModal .photo_comments").height(b)):(b=
a(window).height(),d=a(window).width(),a("#photoModal #tag-wrapper").height(b-36),a("#photoModal #tag-wrapper .photo_img").height(b-36),a("#photoModal #tag-wrapper").width(d)),t(),a("#photo_src").css("visibility","visible"))}),a(document).keydown(function(b){a("#theaterPhotoComment").is(":focus")||a('[id^="message_item_comment_edit"]').is(":focus")||(37==b.keyCode?a("#photo_left_arrow_lg").trigger("click"):39==b.keyCode&&a("#photo_right_arro_lgw").trigger("click"))}),L=!0);a("#photo_thumbs ul li").unbind("click");
a("#photo_thumbs ul li").click(function(){a("#photo_thumbs ul li").removeClass("active");a(this).addClass("active")});a("#photo_wrapper").spin("large");a("#tag-wrapper").hide();url=k?c+"/uid:"+k:e?c+"?uid="+e:c;w=window.location.href;window.history.pushState({photo_id:c},"",mooConfig.url.base+"/photos/view/"+url);window.history.replaceState({photo_id:c},"",mooConfig.url.base+"/photos/view/"+url);O=window.location;I()},I=function(){a("#photo_wrapper .toogleThumb").unbind("click");a("#photo_wrapper .toogleThumb").click(function(){a("#photo_thumbs").toggle();
a("#thumb_list_popup").is(":visible")&&n.setCurrent(a("#photo_thumb_"+c).index())});a("#set_photo_cover").unbind("click");a("#set_photo_cover").click(function(){ea()});m=!1;a("#tagPhoto").unbind("click");a("#tagPhoto").click(function(){m?(m=!1,a("#tag-wrapper img").css("cursor","default"),a("#tagPhoto a").html(g.__("tag_photo")),a("#tag-name").unbind(),a("#tag-submit").unbind(),E()):fa()});a("#set_profile_picture").unbind("click");a("#set_profile_picture").click(function(){ga()});a("#delete_photo").unbind("click");
a("#delete_photo").click(function(){l=""!=l?l:"0";F.confirm(g.__("are_you_delete"),mooConfig.url.base+"/photos/ajax_remove/photo_id:"+c+"/next_photo:"+l)});a("#photo_close_icon").unbind("click");a("#photo_close_icon").click(function(){history.pushState({},"",w)});a(".sharethis_theater").hideshare({media:u,linkedin:!1,link:O});Y.registerImageComment();500<a("#theaterComments").height()&&a("#theaterComments").slimScroll({height:"500px",start:"top"}).bind("slimscroll",function(b,d){"bottom"==d&&""!=
mooConfig.autoLoadMore&&0<a("#photoModal .view-more").length&&(a("#photoModal .view-more").before('<div style="text-align: center" class="loading"><img src="'+mooConfig.url.base+'/img/loading.gif" /></div>'),a("#photoModal .view-more").find("a").trigger("click"))});a("#theaterPhotoComment").autogrow()},E=function(){a("#tag-target").fadeOut();a("#tag-input").fadeOut();a("#tag-name").val("")},fa=function(){m=!0;a("#tag-wrapper img").css("cursor","crosshair");a("#tagPhoto a").html(g.__("done_tagging"));
a("#tag-wrapper img").unbind("click");a("#tag-wrapper img").click(function(b){m&&(y=b.pageX-a("#tag-wrapper").offset().left,z=b.pageY-a("#tag-wrapper").offset().top,A=a("#tag-target").outerWidth(),B=a("#tag-target").outerHeight(),p=y-A/2,q=z-B/2,C=y+A/2,D=z-B/2,"block"==a("#tag-target").css("display")?(a("#tag-target").animate({left:p,top:q},500),a("#tag-input").animate({left:C,top:D},500)):(a("#tag-target").css({left:p,top:q}).fadeIn(),a("#tag-input").css({left:C,top:D}).fadeIn()),a("#tag-name").focus(),
a("#friends_list").html(a("#friends").html()),a(".tagFriends").unbind("click"),a(".tagFriends").on("click",function(){var b=a(this).data();r(b.id,b.tagValue)}))});a("#tag-cancel").unbind("click");a("#tag-cancel").click(function(){E();return!1});a("#tag-name").keyup(function(a){13==a.keyCode&&r(0,"")});a("#tag-submit").unbind("click");a("#tag-submit").click(function(){r(0,"");return!1})},r=function(b,d){if(""!=b||""!=a("#tag-name").val()){var e="left:"+p+"px; top:"+q+"px";a("#photo_wrapper").spin("large");
a.post(mooConfig.url.base+"/photos/ajax_tag",{photo_id:c,uid:b,value:a("#tag-name").val(),style:e},function(c){a("#photo_wrapper").spin(!1);c=a.parseJSON(c);1==c.result?(d=b?'<a href="'+mooConfig.url.base+"/users/view/"+b+'">'+d+"</a>":a("#tag-name").val(),a("#tags").append('<span id="hotspot-item-0-'+c.id+'" data-tag-id="'+c.id+'" class="photoDetailTags">'+d+'<a href="javascript:void(0)" class="photoDetailRemoveTags" data-id="'+c.id+'"><i class="material-icons cross-icon-sm">clear</i></a></span>'),
a("#tag-wrapper .photo_img").append('<div id="hotspot-0-'+c.id+'" class="hotspot" style="'+e+'"><span>'+d+"</span></div>"),E(),Z++,S()):F.alert(c.message)})}},R=function(b,c){a("#hotspot-item-"+b).fadeOut();a("#hotspot-"+b).fadeOut();a.post(mooConfig.url.base+"/photos/ajax_remove_tag",{tag_id:c})},Q=function(b){a("#hotspot-"+b).addClass("hotspothover")},P=function(b){a("#hotspot-"+b).removeClass("hotspothover")},T=function(){x=!1;n=a("#thumb_list_popup").elastislide({minItems:2,onReady:function(){n.setCurrent(a("#photo_thumb_"+
c).index());a("#photo_thumbs").spin(!1);a("#photo_thumbs").css("visibility","visible");992>a(window).width()&&!x&&(x=!0,a("#photo_thumbs").toggle())}});a("#photo_thumb_"+c).addClass("active")},ea=function(){a("#set_cover").spin("custom");a.post(mooConfig.url.base+"/users/set_photo_as_cover",{photo_id:c},function(b){b=a.parseJSON(b);location.assign(b.url)})},ga=function(){a("#set_avatar").spin("custom");a.post(mooConfig.url.base+"/users/set_photo_as_profile_picture",{photo_id:c},function(b){b=a.parseJSON(b);
window.location=b.url})};return{init:function(){N||da();N=!0;ca()},initShowPhoto:S,start:function(){V()},submitTag:function(a,c){r(a,c)},removeTag:function(a,c){R(a,c)},hideTag:function(a){P(a)},showTag:function(a){Q(a)},showPhotoWrapper:function(){H()},showPhoto:function(a,c){"undefined"==typeof c&&(c=!1);J(a,c)},setActive:function(a){K=a}}});