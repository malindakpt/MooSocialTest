(function(a,c){"function"===typeof define&&define.amd?define("jquery mooBehavior mooFileUploader mooAjax mooOverlay mooAlert mooPhrase mooGlobal tinyMCE mooUser".split(" "),c):"object"===typeof exports?module.exports=c(require("jquery")):a.mooTopic=c()})(this,function(a,c,k,n,p,q,h,l,f,m){var g=function(){a(".deleteTopic").unbind("click");a(".deleteTopic").click(function(){var b=a(this).data(),b=mooConfig.url.base+"/topics/do_delete/"+b.id;q.confirm(h.__("are_you_sure_you_want_to_remove_this_topic"),
b)})};return{initOnCreate:function(){a("#saveBtn").unbind("click");a("#saveBtn").click(function(){a(this).addClass("disabled");null!==f.activeEditor&&a("#editor").val(f.activeEditor.getContent());c.createItem("topics",!0)});var b=new k.fineUploader({element:a("#attachments_upload")[0],autoUpload:!1,text:{uploadButton:'<div class="upload-section"><i class="fa fa-file-text-o"></i>'+h.__("span_drag_or_span_click_here_to_upload_files")+" </div>"},validation:{allowedExtensions:mooConfig.attachmentExt,
sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/topic/topic_upload/attachments/"+a("#plugin_topic_id").val()},callbacks:{onError:l.errorHandler,onComplete:function(b,e,d){e=a("#attachments").val();d.attachment_id?(f.activeEditor.insertContent('<p><a href="'+mooConfig.url.base+"/attachments/download/"+d.attachment_id+'" class="attached-file">'+d.original_filename+"</a></p><br>"),""==e?a("#attachments").val(d.attachment_id):a("#attachments").val(e+","+d.attachment_id)):(b||d.thumb)&&
f.activeEditor.insertContent('<p align="center"><a href="'+d.large+'" class="attached-image"><img src="'+d.thumb+'"></a></p><br>')}}});a("#triggerUpload").click(function(){b.uploadStoredFiles()});new k.fineUploader({element:a("#topic_thumnail")[0],multiple:!1,text:{uploadButton:'<div class="upload-section"><i class="material-icons">photo_camera</i>'+h.__("drag_or_click_here_to_upload_photo")+"</div>"},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+
"/topic/topic_upload/avatar"},callbacks:{onError:l.errorHandler,onComplete:function(b,e,d){a("#topic_thumnail_preview > img").attr("src",d.thumb);a("#topic_thumnail_preview > img").show();a("#thumbnail").val(d.file_path)}}});a(".attach_remove").unbind("click");a(".attach_remove").click(function(){var b=a(this),e=a(this).data();n.post({url:mooConfig.url.base+"/attachments/ajax_remove/"+e.id},function(d){b.parent().fadeOut();d=a("#attachments").val().split(",");var e=d.indexOf(b.attr("data-id"));d.splice(e,
1);a("#attachments").val(d.join(","))});return!1});g();a("#toggleUploader").unbind("click");a("#toggleUploader").on("click",function(){a("#images-uploader").slideToggle()})},initOnView:function(){p.registerImageOverlay();g()},initOnListing:function(){c.initMoreResults();g();a(".likeItem").unbind("click");a(".likeItem").click(function(){var b=a(this),c=a(this).data(),e=c.status;a.post(mooConfig.url.base+"/likes/ajax_add/"+c.type+"/"+c.id+"/"+e,{noCache:1},function(d){try{var c=a.parseJSON(d);b.parents(".like-section:first").find(".likeCount:first").html(parseInt(c.like_count));
b.parents(".like-section:first").find(".dislikeCount:first").html(parseInt(c.dislike_count));e?(b.toggleClass("active"),b.next().next().removeClass("active")):(b.toggleClass("active"),b.prev().prev().removeClass("active"))}catch(f){m.validateUser()}})})},toggleUploader:function(){a("#images-uploader").slideToggle()},initOnGroupListing:function(){c.initMoreResults();g();a(".likeItem").unbind("click");a(".likeItem").click(function(){var b=a(this),c=a(this).data(),e=c.status;a.post(mooConfig.url.base+
"/likes/ajax_add/"+c.type+"/"+c.id+"/"+e,{noCache:1},function(d){try{var c=a.parseJSON(d);b.parents(".like-section:first").find(".likeCount:first").html(parseInt(c.like_count));b.parents(".like-section:first").find(".dislikeCount:first").html(parseInt(c.dislike_count));e?(b.toggleClass("active"),b.next().next().removeClass("active")):(b.toggleClass("active"),b.prev().prev().removeClass("active"))}catch(f){m.validateUser()}})})}}});