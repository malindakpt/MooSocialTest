(function(a,e){"function"===typeof define&&define.amd?define("jquery mooBehavior mooAlert mooAjax mooPhrase mooOverlay mooPhotoTheater mooLike hideshare spinner".split(" "),e):"object"===typeof exports?module.exports=e(require("jquery")):a.mooPhoto=e()})(this,function(a,e,n,N,h,C,I,J){var p=!1,f=!1,k,l,q,r,t,u,v,w,d=0,g=0,x=0,m=0,D=2,F=function(){a(".showPhoto").unbind("click");a(".showPhoto").on("click",function(){var b=a(this).data();E(b.id)})},K=function(){a(".rotate_img").unbind("click");a(".rotate_img").on("click",
function(){var b=a(this).data();a("#photo_wrapper").spin("large");var c=b.id;a.post(mooConfig.url.base+"/photos/ajax_rotate",{id:c,mode:b.mode},function(b){a("#photo_wrapper").spin(!1);a("#photo_src").attr("src",a("#photo_src").attr("src")+"?"+(new Date).getTime());a("#photo_thumb_"+c+" > a > img").attr("src",a("#photo_thumb_"+c+" > a > img").attr("src")+"?"+(new Date).getTime());a("#layer_square_modal_"+c).length&&(b=a("#layer_square_modal_"+c).css("background-image"),b=b.replace(/^url\(['"]?/,"").replace(/['"]?\)$/,
""),b+="?"+(new Date).getTime(),a("#layer_square_modal_"+c).css("background-image","url("+b+")"));a("#layer_square_"+c).length&&(b=a("#layer_square_"+c).css("background-image"),b=b.replace(/^url\(['"]?/,"").replace(/['"]?\)$/,""),b+="?"+(new Date).getTime(),a("#layer_square_"+c).css("background-image","url("+b+")"));a(".photoModal").each(function(){var b=a(this).find("img:first");b.attr("src",b.attr("src")+"?"+(new Date).getTime())})})})},H=function(){a("#photo_wrapper").spin("large");a.post(mooConfig.url.base+
"/photos/ajax_fetch",{type:type,album_type:album_type,album_type_id:album_type_id,target_id:target_id,page:D,taguserid:m},function(b){a("#photo_wrapper").spin(!1);""!=b&&(D++,a("#photo_thumbs ul").append(b),a("#photo_load_btn").parent().remove(),a("#photo_load_btn").unbind("click"),a("#photo_load_btn").on("click",function(){H()}),a(".showPhoto").unbind("click"),a(".showPhoto").on("click",function(){var b=a(this).data();E(b.id)}))})},L=function(){a("#set_cover").spin("tiny");a.post(mooConfig.url.base+
"/users/set_photo_as_cover",{photo_id:d},function(b){b=a.parseJSON(b);window.location=b.url})},A=function(){f=!0;a("#tag-wrapper img").css("cursor","crosshair");a("#tagPhoto a").html(h.__("done_tagging"));a("#tag-wrapper img").unbind("click");a("#tag-wrapper img").click(function(b){f&&(q=b.pageX-a("#tag-wrapper").offset().left,r=b.pageY-a("#tag-wrapper").offset().top,t=a("#tag-target").outerWidth(),u=a("#tag-target").outerHeight(),k=q-t/2,l=r-u/2,v=q+t/2,w=r-u/2,"block"==a("#tag-target").css("display")?
(a("#tag-target").animate({left:k,top:l},500),a("#tag-input").animate({left:v,top:w},500)):(a("#tag-target").css({left:k,top:l}).fadeIn(),a("#tag-input").css({left:v,top:w}).fadeIn()),a("#tag-name").focus(),a("#friends_list").html(a("#friends").html()),a(".tagFriends").unbind("click"),a(".tagFriends").on("click",function(){var b=a(this).data();y(b.id,b.tagValue)}))});a("#tag-cancel").unbind("click");a("#tag-cancel").click(function(){z();return!1});a("#tag-name").keyup(function(a){13==a.keyCode&&y(0,
"")});a("#tag-submit").unbind("click");a("#tag-submit").click(function(){y(0,"");return!1})},y=function(b,c){if(""!=b||""!=a("#tag-name").val()){var G="left:"+k+"px; top:"+l+"px";a("#photo_wrapper").spin("large");a.post(mooConfig.url.base+"/photos/ajax_tag",{photo_id:d,uid:b,value:a("#tag-name").val(),style:G},function(d){a("#photo_wrapper").spin(!1);d=a.parseJSON(d);1==d.result?(c=b?'<a href="'+mooConfig.url.base+"/users/view/"+b+'">'+c+"</a>":a("#tag-name").val(),a("#tags").append('<span id="hotspot-item-'+
g+'" onmouseover="showTag('+g+')" onmouseout="hideTag('+g+')">'+c+'<a href="javascript:void(0)" onclick="removeTag('+g+", "+d.id+')"><i class="material-icons cross-icon-sm">clear</i></a></span>'),a("#tag-wrapper").append('<div id="hotspot-'+g+'" class="hotspot" style="'+G+'"><span>'+c+"</span></div>"),z(),g++):n.alert(d.message)})}},M=function(){a("#set_avatar").spin("tiny");a.post(mooConfig.url.base+"/users/set_photo_as_profile_picture",{photo_id:d},function(b){b=a.parseJSON(b);window.location=b.url})},
E=function(b){d=b;a("#photo_wrapper").spin("large");var c="";p=!1;c=x?b+"/uid:"+x:m?b+"?uid="+m:b;a("#preload").load(mooConfig.url.base+"/photos/ajax_view/"+c,{noCache:1},function(){a("#photo_thumbs .active").removeClass("active");a("#photo_thumb_"+b).addClass("active");var c=a("#preload").html();""!=c&&(a("#preload").html(""),a("#photo-content").html(c),C.registerOverlay(),a(".sharethis").hideshare({media:a("#photo_src").attr("src"),linkedin:!1,link:window.location.href}),f&&A());a("#photo_wrapper").fadeIn()});
window.history.pushState({photo_id:d},"",mooConfig.url.base+"/photos/view/"+c+"#content")},z=function(){a("#tag-target").fadeOut();a("#tag-input").fadeOut();a("#tag-name").val("")},B=function(){a(".deleteAlbum").unbind("click");a(".deleteAlbum").click(function(){var b=a(this).data(),b=mooConfig.url.base+"/albums/do_delete/"+b.id;n.confirm(h.__("are_you_sure_you_want_to_delete_this_album_all_photos_will_also_be_deleted"),b)})};return{init:function(){I.init()},initOnCreateAlbum:function(){a("#saveBtn").unbind("click");
a("#saveBtn").click(function(){a(this).addClass("disabled");e.createItem("albums",!0)})},initOnListing:function(){e.initMoreResults();B()},initOnEditAlbum:function(){a("#select_photos").change(function(){"move"==a(this).val()?a("#album_id").show():a("#album_id").hide()});B()},initOnViewAlbum:function(){B()},initOnPhotoView:function(b){d=b.photo_id;photo_thumb=b.photo_thumb;x=b.tag_uid;m=b.taguserid;type=b.type;target_id=b.target_id;album_type=b.album_type;album_type_id=b.album_type_id;a("#photo_thumbs ul li").unbind("click");
a("#photo_thumbs ul li:not(.viewmore-photo)").click(function(){a("#photo_thumbs ul li").removeClass("active");a(this).addClass("active")});a("#photo_thumb_"+d).addClass("active");a(".sharethis").hideshare({media:mooConfig.url.base+"uploads/photos/thumbnail/"+d+"/"+photo_thumb,linkedin:!1});a("#photo_src").on("load",function(){if(!p){p=!0;var b=a("#preload").html();""!=b&&(a("#preload").html(""),a("#photo-content").html(b),C.registerOverlay(),a(".sharethis").hideshare({media:a("#photo_src").attr("src"),
linkedin:!1,link:window.location.href}),f&&A());a("#photo_wrapper").fadeIn()}});a("#delete_photo").unbind("click");a("#delete_photo").on("click",function(){var b=a(this).data().nextPhoto,b="undefined"!==typeof b?b:"0";n.confirm(h.__("are_you_sure_you_want_to_delete_this_photo"),mooConfig.url.base+"/photos/ajax_remove/photo_id:"+d+"/next_photo:"+b)});a(".set_cover").unbind("click");a(".set_cover").on("click",function(){L()});a(".set_avatar").unbind("click");a(".set_avatar").on("click",function(){M()});
a("#tagPhoto").unbind("click");a("#tagPhoto").click(function(){f?(f=!1,a("#tag-wrapper img").css("cursor","default"),a("#tagPhoto a").html(h.__("tag_photo")),a("#tag-name").unbind(),a("#tag-submit").unbind(),z()):A()});a(".photoDetailTags").on("mouseout",function(){var b=a(this).data();a("#hotspot-0-"+b.tagId).removeClass("hotspothover")}).on("mouseover",function(){var b=a(this).data();a("#hotspot-0-"+b.tagId).addClass("hotspothover")});a(".photoDetailRemoveTags").unbind("click");a(".photoDetailRemoveTags").on("click",
function(){var b=a(this).data(),d="0-"+b.id,b=b.id;a("#hotspot-item-"+d).fadeOut();a("#hotspot-"+d).fadeOut();a.post(mooConfig.url.base+"/photos/ajax_remove_tag",{tag_id:b})});J.initLikePhoto();F();a("#photo_load_btn").unbind("click");a("#photo_load_btn").on("click",function(){H()});K()},initShowPhoto:F}});