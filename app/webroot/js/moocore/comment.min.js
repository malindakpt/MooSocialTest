(function(a,e){"function"===typeof define&&define.amd?define("jquery mooPhrase mooMention mooEmoji mooAttach mooBehavior mooLike mooTooltip autogrow overlay".split(" "),e):"object"===typeof exports?module.exports=e(require("jquery")):a.mooComment=e()})(this,function(a,e,f,l,p,g,C,q){var h=[],k=[],t=function(){a(".showCommentBtn").unbind("onfocus");a(".showCommentBtn").on("focus",function(){var b=a(this).data();r(b.id)})},u=function(){a(".removeItemComment").unbind("click");a(".removeItemComment").click(function(){var b=
a(this).data();D(b.id,b.photoComment)})},w=function(){a(".editItemComment").unbind("click");a(".editItemComment").click(function(){var b=a(this).data();v(b.id,b.photoComment)})},E=function(b){-1===h.indexOf(b)&&a.post(mooConfig.url.base+"/activities/ajax_loadActivityCommentEdit/"+b,function(d){a("#activity_feed_comment_text_"+b).hide();a(d).insertAfter(a("#activity_feed_comment_text_"+b));p.registerAttachCommentEdit("activity",b);h.push(b);a("textarea:not(.no-grow)").autogrow();f.init(a(d).find("textarea").attr("id"),
"edit_activity");l.init(a(d).find("textarea").attr("id"),"edit_activity")})},F=function(b){a.fn.SimpleModal({btn_ok:e.__("btn_ok"),btn_cancel:e.__("cancel"),callback:function(){a.post(mooConfig.url.base+"/activities/ajax_removeComment",{id:b},function(){a("#comment_"+b).fadeOut("normal",function(){a("#comment_"+b).remove()})})},title:e.__("please_confirm"),contents:e.__("please_confirm_remove_this_activity"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal()},y=function(){a(".removePhotoComment").unbind("click");
a(".removePhotoComment").on("click",function(){var b=a(this).data();x(b.type,b.id)})},G=function(){a(".cancelEditActivityComment").unbind("click");a(".cancelEditActivityComment").click(function(){var b=a(this).data();m(b.id)})},H=function(){a(".confirmEditActivityComment").unbind("click");a(".confirmEditActivityComment").click(function(){var b=a(this).data();z(b.id)})},I=function(){a(".cancelEditItemComment").unbind("click");a(".cancelEditItemComment").click(function(){var b=a(this).data();n(b.id,
b.photoComment)})},J=function(){a(".confirmEditItemComment").unbind("click");a(".confirmEditItemComment").click(function(){var b=a(this).data();A(b.id,b.photoComment)})},B=function(b){if(""!=a.trim(a("#postComment").val())||""!=a.trim(a("#theaterPhotoComment").val())||""!=a("#comment_image_"+b).val())if("1"===mooConfig.comment_sort_style){a(".shareButton").addClass("disabled");a(".shareButton").append('<i class="icon-refresh icon-spin"></i>');var d="";a("#commentForm").length&&(d=a("#commentForm").serialize());
a("#theaterPhotoCommentForm").length&&(d=a("#theaterPhotoCommentForm").serialize());a.post(mooConfig.url.base+"/comments/ajax_share",d,function(c){a(".shareButton").removeClass("disabled");a(".shareButton i").remove();a(".commentForm").css("height","35px");a("#postComment").length&&a("#postComment").val("");a("#theaterPhotoComment").length&&a("#theaterPhotoComment").val("");""!=c&&(a("#theaterComments").length?a("#theaterComments").append(c):a("#comments").append(c),a(".slide").slideDown(),a("#theaterComments").length||
a("#comment_count").html(parseInt(a("#comment_count").html())+1),a("#comment_preview_image_"+b).html(""),a("#comment_image_"+b).val(""),a("#comment_button_attach_"+b).show(),g.registerImageComment(),c=a("#postComment"),f.resetMention(c),c=a("#theaterPhotoComment"),f.resetMention(c),q.init())})}else a(".shareButton").addClass("disabled"),a(".shareButton").prepend('<i class="icon-refresh icon-spin"></i>'),d="",a("#commentForm").length&&(d=a("#commentForm").serialize()),a("#theaterPhotoCommentForm").length&&
(d=a("#theaterPhotoCommentForm").serialize()),a.post(mooConfig.url.base+"/comments/ajax_share",d,function(c){a(".shareButton").removeClass("disabled");a(".shareButton i").remove();a(".commentForm").css("height","35px");a("#postComment").length&&a("#postComment").val("");a("#theaterPhotoComment").length&&a("#theaterPhotoComment").val("");""!=c&&(a("#theaterComments").length?a("#theaterComments").prepend(c):a("#comments").prepend(c),a(".slide").slideDown(),a("#theaterComments").length||a("#comment_count").html(parseInt(a("#comment_count").html())+
1),a("#comment_preview_image_"+b).html(""),a("#comment_image_"+b).val(""),a("#comment_button_attach_"+b).show(),g.registerImageComment(),c=a("#postComment"),f.resetMention(c),c=a("#theaterPhotoComment"),f.resetMention(c),q.init())});else a.fn.SimpleModal({btn_ok:e.__("btn_ok"),btn_ok:e.__("btn_ok"),model:"modal",title:e.__("warning"),contents:e.__("comment_empty")}).showModal()},m=function(b){a("#message_activity_comment_edit_"+b).siblings(".textoverlay")&&a("#message_activity_comment_edit_"+b).destroyOverlayInstance(a("#message_activity_comment_edit_"+
b));a("#activity_feed_comment_text_"+b).show();a("#activity_comment_edit_"+b).remove();b=a.inArray(b,h);h.splice(b,1)},z=function(b){if(""!=a.trim(a("#message_activity_comment_edit_"+b).val())||""!=a("#activity_comment_attach_id_"+b).val()){var d;d=0!=a("#message_activity_comment_edit_"+b+"_hidden").length?a("#message_activity_comment_edit_"+b+"_hidden").val():a("#message_activity_comment_edit_"+b).val();a.post(mooConfig.url.base+"/activities/ajax_editActivityComment/"+b,{comment_attach:a("#activity_comment_attach_id_"+
b).val(),message:d},function(c){a("#message_activity_comment_edit_"+b).siblings(".textoverlay")&&a("#message_activity_comment_edit_"+b).destroyOverlayInstance(a("#message_activity_comment_edit_"+b));a("#activity_feed_comment_text_"+b).html(a(c).html());a("#history_activity_comment_"+b).show();g.registerImageComment();m(b)})}},D=function(b,d){a.fn.SimpleModal({btn_ok:e.__("btn_ok"),btn_cancel:e.__("btn_cancel"),callback:function(){a.post(mooConfig.url.base+"/comments/ajax_remove",{id:b},function(){a("#itemcomment_"+
b).fadeOut("normal",function(){a("#itemcomment_"+b).remove();"0"!=d?a("#comment_count").html(parseInt(a("#comment_count").html())-1):a("#photo_comment_"+b).remove()})})},title:e.__("please_confirm"),contents:e.__("confirm_delete_comment"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal()},v=function(b,d){if(-1===k.indexOf(b)){var c=0;"0"!=d&&(c=1);a.post(mooConfig.url.base+"/comments/ajax_loadCommentEdit/"+b,{isPhotoComment:c},function(c){var e="#item_feed_comment_text_";"0"!=d&&(e="#photo_feed_comment_text_");
a(e+b).hide();a(c).insertAfter(a(e+b));p.registerAttachCommentEdit("item",b);k.push(b);a("textarea:not(.no-grow)").autogrow();f.init(a(c).find("textarea").attr("id"),"edit_activity");l.init(a(c).find("textarea").attr("id"))})}},n=function(b,d){a("#message_item_comment_edit_"+b).siblings(".textoverlay")&&a("#message_item_comment_edit_"+b).destroyOverlayInstance(a("#message_item_comment_edit_"+b));var c="#item_feed_comment_text_";1==d&&(c="#photo_feed_comment_text_");a(c+b).show();a("#item_comment_edit_"+
b).remove();c=a.inArray(b,k);k.splice(c,1)},A=function(b,d){if(""!=a.trim(a("#message_item_comment_edit_"+b).val())||""!=a("#item_comment_attach_id_"+b).val()){var c;c=0!=a("#message_item_comment_edit_"+b+"_hidden").length?a("#message_item_comment_edit_"+b+"_hidden").val():a("#message_item_comment_edit_"+b).val();a.post(mooConfig.url.base+"/comments/ajax_editComment/"+b,{comment_attach:a("#item_comment_attach_id_"+b).val(),message:c},function(c){a("#message_item_comment_edit_"+b).siblings(".textoverlay")&&
a("#message_item_comment_edit_"+b).destroyOverlayInstance(a("#message_item_comment_edit_"+b));a("#item_feed_comment_text_"+b).html(a(c).html());a("#photo_feed_comment_text_"+b).html(a(c).html());a("#history_item_comment_"+b).show();a("#history_activity_comment_"+b).show();g.registerImageComment();n(b,d)})}},x=function(b,d){a("#"+b+"_comment_attach_id_"+d).val("");a("#"+b+"_comment_preview_attach_"+d).html("");a("#"+b+"_comment_attach_"+d).show()},r=function(b){a("#commentButton_"+b).show();0!=a("#commentForm_"+
b).length&&0==a("#commentForm_"+b).siblings("input.messageHidden").length&&(f.init("commentForm_"+b),l.init("commentForm_"+b))};return{ajax_postComment:B,initEditActivityComment:function(){a(".editActivityComment").unbind("click");a(".editActivityComment").click(function(){var b=a(this).data();E(b.activityCommentId)})},cancelEditActivityComment:m,confirmEditActivityComment:z,editItemComment:v,cancelEditItemComment:n,confirmEditItemComment:A,removePhotoComment:x,initShowCommentBtn:t,initShowCommentForm:function(){a(".showCommentForm").unbind("click");
a(".showCommentForm").click(function(){var b=a(this).data().id;a("#comments_"+b).show();a("#newComment_"+b).show();a("#commentForm_"+b).focus();a("#commentForm_"+b).focus()})},initOnCommentForm:function(){t();a(".shareButton").unbind("click");a(".shareButton").click(function(){var b=a(this).data();B(b.id)})},initOnCommentListing:function(){a("#comments li").hover(function(){a(this).contents(".cross-icon").show()},function(){a(this).contents(".cross-icon").hide()});g.initMoreResults();C.initLikeActivity();
u();w()},initOnAjaxLoadCommentEdit:function(){a("textarea:not(.no-grow)").autogrow();I();J();y()},initRemoveItemComment:u,initEditItemComment:w,showCommentButton:r,initRemoveActivityComment:function(){a(".removeActivityComment").unbind("click");a(".removeActivityComment").click(function(){var b=a(this).data();F(b.activityCommentId)})},initOnAjaxLoadActivityCommentEdit:function(){G();H();y()}}});