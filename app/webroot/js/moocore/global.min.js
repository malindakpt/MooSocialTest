(function(a,c){"function"===typeof define&&define.amd?define("jquery mooAjax mooButton mooAlert mooPhrase spinner tokeninput".split(" "),c):"object"===typeof exports?module.exports=c(require("jquery")):a.mooGlobal=c()})(this,function(a,c,e,g,f){return{initInviteFriendBtn:function(){a("#inviteButton").unbind("click");a("#inviteButton").click(function(){a("#inviteButton").spin("small");e.disableButton("inviteButton");a(".error-message").hide();c.post({url:mooConfig.url.base+"/friends/ajax_invite",data:a("#inviteForm").serialize()},
function(b){e.enableButton("inviteButton");a("#inviteButton").spin(!1);b=a.parseJSON(b);1==b.result?(a("#to").val(""),a("#message").val(""),a(".error-message").hide(),g.alert(f.__("your_invitation_has_been_sent"))):(a(".error-message").show(),a(".error-message").html(b.message))});return!1})},initConversationSendBtn:function(){a("#friends").tokenInput(mooConfig.url.base+"/friends/do_get_json",{preventDuplicates:!0,hintText:f.__("enter_a_friend_s_name"),noResultsText:f.__("no_results"),tokenLimit:20,
resultsFormatter:function(a){return"<li>"+a.avatar+a.name+"</li>"}});a("#sendButton").unbind("click");a("#sendButton").click(function(){e.disableButton("sendButton");a("#sendButton").spin("small");a.post(mooConfig.url.base+"/conversations/ajax_doSend",a("#sendMessage").serialize(),function(b){e.enableButton("sendButton");a("#sendButton").spin(!1);b=a.parseJSON(b);1==b.result?(a("#subject").val(""),a("#message").val(""),a(".error-message").hide(),a("#themeModal").modal("hide"),g.alert(f.__("your_message_has_been_sent"))):
(a(".error-message").show(),a(".error-message").html(b.message))});return!1})},initLeaveConversation:function(){a(".leaveConversation").unbind("click");a(".leaveConversation").on("click",function(){var b=a(this).data();g.confirm(b.msg,b.url)})},errorHandler:function(b,d,c){0<a(this._element).find(".qq-upload-list .errorUploadMsg").length?a(this._element).find(".qq-upload-list .errorUploadMsg").html(c):a(this._element).find(".qq-upload-list").prepend('<div class="errorUploadMsg">'+c+"</div>");a(this._element).find(".qq-upload-fail").remove()},
initConversationAjaxAdd:function(){a("#friends").tokenInput(mooConfig.url.base+"/friends/do_get_json",{preventDuplicates:!0,hintText:f.__("enter_a_friend_s_name"),noResultsText:f.__("no_results"),tokenLimit:20,resultsFormatter:function(a){return"<li>"+a.avatar+a.name+"</li>"}});a("#sendButton").click(function(){e.disableButton("sendButton");a.post(mooConfig.url.base+"/conversations/ajax_doAdd",a("#sendMessage").serialize(),function(b){e.enableButton("sendButton");b=a.parseJSON(b);1==b.result?window.location.reload():
(a(".error-message").show(),a(".error-message").html(b.message))});return!1})},initMsgList:function(){a(".markMsgStaus").unbind("click");a(".markMsgStaus").click(function(){var b=a(this).data(),d=a(this);c.post({url:mooConfig.url.base+"/conversations/mark_read",data:{id:b.id,status:b.status}},function(b){b=a.parseJSON(b);var c=a("#messages .badge_counter").html();"1"===b.status?(d.parents("li:first").addClass("unread"),d.hide(),d.prev().show(),a("#messages .badge_counter").html(parseInt(c)+1),0<a(".conversation_count").length?
a(".conversation_count").html(parseInt(c)+1):a("#conversationDropdown").append('<span class="conversation_count">1</span>')):(d.parents("li:first").removeClass("unread"),d.hide(),d.next().show(),a("#messages .badge_counter").html(parseInt(c)-1),0<parseInt(c)-1?0<a(".conversation_count").length?a(".conversation_count").html(parseInt(c)-1):a("#conversationDropdown").append('<span class="conversation_count">1</span>'):a(".conversation_count")&&a(".conversation_count").remove())})})}}});
